<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âœ¨ è¶…æµªæ¼«åŠ¨æ€åœ£è¯æ ‘ | GitHub Pages éƒ¨ç½²ç‰ˆ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #0c2b3e 0%, #1a5f7a 50%, #0a2e38 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            padding: 20px;
        }

        /* é›ªèŠ±å®¹å™¨ */
        #snowflakesContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 2;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(0, 40, 60, 0.7);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: #FFD700;
            text-shadow: 0 0 15px #FF4500;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #98FB98;
            margin-bottom: 15px;
        }

        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 15px;
            background: linear-gradient(135deg, #FF416C 0%, #FF4B2B 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 3px 10px rgba(255, 65, 108, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 65, 108, 0.6);
        }

        .btn i {
            font-size: 0.9rem;
        }

        /* åœ£è¯æ ‘åŒºåŸŸ */
        .tree-section {
            position: relative;
            width: 100%;
            height: 400px;
            margin: 30px auto;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }

        #treeCanvas {
            position: relative;
            z-index: 3;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.5));
        }

        .tree-shadow {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 30px;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 70%);
            z-index: 2;
        }

        /* å½©ç¯ */
        .light {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 4;
            animation: twinkle 1.5s infinite alternate;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        /* æ ‘é¡¶æ˜Ÿæ˜Ÿ */
        .tree-star {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -100%);
            color: gold;
            font-size: 2.5rem;
            text-shadow: 0 0 20px gold;
            z-index: 5;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from { transform: translate(-50%, -100%) rotate(0deg); }
            to { transform: translate(-50%, -100%) rotate(360deg); }
        }

        /* ç¥ç¦åŒºåŸŸ */
        .blessing-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            border: 2px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .blessing-section h2 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        #dynamicMessage {
            font-size: 1.3rem;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid rgba(255, 215, 0, 0.1);
            transition: all 0.5s ease;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
            box-shadow: 0 3px 10px rgba(33, 150, 243, 0.4);
        }

        /* ç¥ç¦å†å² */
        .history-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-section h3 {
            color: #87CEEB;
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #historyList {
            list-style-type: none;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }

        #historyList li {
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            border-left: 3px solid #FFD700;
            animation: fadeIn 0.3s ease;
            font-size: 0.9rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ä½¿ç”¨è¯´æ˜ */
        .instructions {
            background: rgba(0, 40, 60, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .instructions p {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instructions i {
            color: #FFD700;
        }

        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            background: rgba(0, 20, 40, 0.7);
            border-radius: 15px;
            border-top: 2px solid rgba(255, 215, 0, 0.2);
        }

        .footer p {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .github-info {
            color: #87CEEB;
            font-size: 0.9rem;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* å¼¹çª— */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background: linear-gradient(135deg, #1a5f7a 0%, #0a2e38 100%);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            width: 90%;
            border: 3px solid #FFD700;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            animation: popupAppear 0.4s ease;
        }

        @keyframes popupAppear {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .popup-content h2 {
            color: #FFD700;
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .popup-content p {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.4;
        }

        /* é›ªèŠ±åŠ¨ç”» */
        @keyframes snowFall {
            0% {
                transform: translateY(-20px) translateX(0) rotate(0deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) translateX(var(--sway)) rotate(360deg);
                opacity: 0;
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .tree-section {
                height: 350px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 280px;
            }
            
            #dynamicMessage {
                font-size: 1.1rem;
                min-height: 50px;
                padding: 12px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header, .blessing-section, .footer {
                padding: 15px;
            }
            
            .tree-section {
                height: 300px;
            }
            
            .tree-star {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- é›ªèŠ±å®¹å™¨ -->
    <div id="snowflakesContainer"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container">
        <header class="header">
            <h1><i class="fas fa-star"></i> è¶…æµªæ¼«åŠ¨æ€åœ£è¯æ ‘ <i class="fas fa-star"></i></h1>
            <p class="subtitle">âœ¨ ä¸“ä¸º GitHub Pages éƒ¨ç½²ä¼˜åŒ– Â· æ‰‹æœº/å¾®ä¿¡å¯ç›´æ¥è®¿é—® âœ¨</p>
            
            <div class="controls">
                <button id="musicToggle" class="btn">
                    <i class="fas fa-music"></i> <span>éŸ³ä¹: å¼€å¯</span>
                </button>
                <button id="snowToggle" class="btn">
                    <i class="fas fa-snowflake"></i> <span>é›ªèŠ±: å¼€å¯</span>
                </button>
                <button id="lightsToggle" class="btn">
                    <i class="fas fa-lightbulb"></i> <span>å½©ç¯: å¼€å¯</span>
                </button>
            </div>
        </header>

        <main>
            <!-- åœ£è¯æ ‘åŒºåŸŸ -->
            <section class="tree-section">
                <div class="tree-star"><i class="fas fa-star"></i></div>
                <canvas id="treeCanvas"></canvas>
                <div class="tree-shadow"></div>
            </section>
            
            <!-- ç¥ç¦åŒºåŸŸ -->
            <section class="blessing-section">
                <h2><i class="fas fa-heart"></i> åœ£è¯ç¥ç¦ <i class="fas fa-heart"></i></h2>
                <div id="dynamicMessage">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–ä½ çš„ä¸“å±åœ£è¯ç¥ç¦ï¼</div>
                
                <div class="action-buttons">
                    <button id="newBlessing" class="btn btn-primary">
                        <i class="fas fa-gift"></i> è·å–æ–°ç¥ç¦
                    </button>
                    <button id="shareButton" class="btn btn-secondary">
                        <i class="fas fa-share-alt"></i> åˆ†äº«ç»™æœ‹å‹
                    </button>
                </div>
                
                <div class="history-section">
                    <h3><i class="fas fa-history"></i> ç¥ç¦è®°å½•</h3>
                    <ul id="historyList"></ul>
                </div>
            </section>
            
            <!-- ä½¿ç”¨è¯´æ˜ -->
            <section class="instructions">
                <p><i class="fas fa-mobile-alt"></i> <strong>æ‰‹æœºä½¿ç”¨ï¼š</strong>è½»è§¦åœ£è¯æ ‘å¯äº¤äº’ï¼Œé•¿æŒ‰å¯ä¿å­˜å›¾ç‰‡</p>
                <p><i class="fas fa-laptop"></i> <strong>ç”µè„‘ä½¿ç”¨ï¼š</strong>é¼ æ ‡æ‚¬åœåœ¨åœ£è¯æ ‘ä¸Šæœ‰æ›´å¤šæ•ˆæœ</p>
                <p><i class="fas fa-exclamation-circle"></i> <strong>æ¸©é¦¨æç¤ºï¼š</strong>é¦–æ¬¡åŠ è½½å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´</p>
            </section>
        </main>

        <footer class="footer">
            <p>ğŸ„ åœ£è¯å¿«ä¹ Â· æ„¿å¹³å®‰å–œä¹å¸¸ä¼´ ğŸ„</p>
            <p class="github-info">
                <i class="fab fa-github"></i> æœ¬é¡µé¢å·²ä¸º GitHub Pages ä¼˜åŒ–<br>
                éƒ¨ç½²åå¯é€šè¿‡é“¾æ¥ç›´æ¥åˆ†äº«ç»™æœ‹å‹
            </p>
        </footer>
    </div>

    <!-- ç¥ç¦å¼¹çª— -->
    <div id="blessingPopup" class="popup-overlay">
        <div class="popup-content">
            <h2 id="popupTitle">åœ£è¯å¿«ä¹ï¼</h2>
            <p id="popupMessage">æ„¿ä½ çš„åœ£è¯å……æ»¡æ¸©é¦¨ä¸å–œæ‚¦</p>
            <button id="closePopup" class="btn">å…³é—­å¼¹çª—</button>
        </div>
    </div>

    <!-- éŸ³é¢‘ï¼ˆä½¿ç”¨å…ç‰ˆç¨éŸ³ä¹ï¼‰ -->
    <audio id="bgMusic" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-christmas-sleigh-bells-229.mp3" type="audio/mpeg">
    </audio>

    <script>
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('åœ£è¯æ ‘é¡µé¢å¼€å§‹åˆå§‹åŒ–...');
            
            // åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶
            initChristmasTree();
            initSnowflakes();
            initBlessings();
            initControls();
            initInteractiveTree();
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            setTimeout(() => {
                showPopup('ğŸ„ æ¬¢è¿æ¥åˆ°åŠ¨æ€åœ£è¯æ ‘ ğŸ„', 'ç‚¹å‡»"è·å–æ–°ç¥ç¦"æŒ‰é’®å¼€å§‹ä½“éªŒï¼');
            }, 800);
        });

        // ç¥ç¦è¯­åº“
        const blessings = [
            { text: "ğŸ„ åœ£è¯å¿«ä¹ï¼æ„¿ä½ çš„ç”Ÿæ´»å……æ»¡çˆ±ä¸å–œæ‚¦", color: "#FF0000" },
            { text: "ğŸŒŸ æ„¿åœ£è¯çš„æ˜Ÿå…‰ï¼Œç…§äº®ä½ å‰è¡Œçš„æ¯ä¸€æ­¥", color: "#FFD700" },
            { text: "â¤ï¸ å¹³å®‰å¤œï¼Œæ„¿å¹³å®‰ä¸å–œä¹å¸¸ä¼´ä½ å·¦å³", color: "#4CAF50" },
            { text: "ğŸ æ¯ä¸€ä»½ç¤¼ç‰©éƒ½æ‰¿è½½ç€ç¥ç¦ï¼Œæ„¿ä½ æ”¶è·æ»¡æ»¡", color: "#2196F3" },
            { text: "âœ¨ åœ£è¯é’Ÿå£°å“èµ·ï¼Œæ„¿ä½ çš„æ¢¦æƒ³éƒ½èƒ½æˆçœŸ", color: "#9C27B0" },
            { text: "ğŸ¦Œ é©¯é¹¿å¸¦ç€ç¥ç¦ï¼Œæ´’æ»¡ä½ çš„æ•´ä¸ªä¸–ç•Œ", color: "#FF9800" },
            { text: "â˜ƒï¸ é›ªèŠ±é£˜è½ï¼Œæ„¿ä½ çš„å¿ƒæ°¸è¿œæ¸©æš–å¦‚æ˜¥", color: "#00BCD4" },
            { text: "ğŸ… åœ£è¯è€äººçš„é­”æ³•ï¼Œè®©å¿«ä¹æ°¸è¿œä¼´éšä½ ", color: "#E91E63" },
            { text: "ğŸ”” é“ƒå„¿å“å®å½“ï¼Œå¹¸ç¦æ­£åœ¨æ•²å“ä½ çš„é—¨", color: "#8BC34A" },
            { text: "ğŸ•¯ï¸ çƒ›å…‰é—ªçƒï¼Œæ„¿å¸Œæœ›ç…§äº®ä½ çš„æ¯ä¸€ä¸ªæ˜å¤©", color: "#FFC107" },
            { text: "â›„ é›ªäººå¾®ç¬‘ï¼Œæ„¿ä½ çš„æ¯ä¸€å¤©éƒ½å……æ»¡æ¬¢ç¬‘", color: "#00ACC1" },
            { text: "ğŸ¶ åœ£è¯æ­Œå£°ä¸­ï¼Œæ„¿ç¾å¥½ä¸ä½ åŒè¡Œ", color: "#AB47BC" }
        ];

        // çŠ¶æ€å˜é‡
        let musicEnabled = true;
        let snowEnabled = true;
        let lightsEnabled = true;
        let blessingHistory = [];
        let lights = [];

        // 1. åˆå§‹åŒ–åœ£è¯æ ‘ç”»å¸ƒ
        function initChristmasTree() {
            console.log('åˆå§‹åŒ–åœ£è¯æ ‘...');
            const canvas = document.getElementById('treeCanvas');
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå°ºå¯¸
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvas.width = Math.min(350, container.clientWidth);
                canvas.height = Math.min(400, container.clientHeight);
                drawTree();
                
                // å¦‚æœå½©ç¯å¼€å¯ï¼Œé‡æ–°åˆ›å»ºå½©ç¯
                if (lightsEnabled) {
                    setTimeout(initLights, 100);
                }
            }
            
            // ç»˜åˆ¶åœ£è¯æ ‘
            function drawTree() {
                const width = canvas.width;
                const height = canvas.height;
                
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, width, height);
                
                // ç»˜åˆ¶æ ‘å¹²
                const trunkWidth = width * 0.12;
                const trunkHeight = height * 0.18;
                const trunkX = width / 2 - trunkWidth / 2;
                const trunkY = height - trunkHeight;
                
                // æ ‘å¹²æ¸å˜
                const trunkGradient = ctx.createLinearGradient(trunkX, trunkY, trunkX + trunkWidth, trunkY + trunkHeight);
                trunkGradient.addColorStop(0, '#8B4513');
                trunkGradient.addColorStop(1, '#A0522D');
                
                ctx.fillStyle = trunkGradient;
                ctx.fillRect(trunkX, trunkY, trunkWidth, trunkHeight);
                
                // æ ‘å¹²çº¹ç†
                ctx.fillStyle = '#D2691E';
                for (let i = 0; i < 4; i++) {
                    const lineY = trunkY + i * (trunkHeight / 4);
                    ctx.fillRect(trunkX, lineY, trunkWidth, 1);
                }
                
                // ç»˜åˆ¶ä¸‰å±‚æ ‘å† 
                const layers = 3;
                
                for (let layer = 0; layer < layers; layer++) {
                    const layerHeight = height * 0.28;
                    const layerWidth = width * (0.85 - layer * 0.15);
                    const layerY = trunkY - layerHeight * (layer + 1) + height * 0.05;
                    const layerX = width / 2 - layerWidth / 2;
                    
                    // åˆ›å»ºæ ‘å† æ¸å˜
                    const treeGradient = ctx.createLinearGradient(
                        layerX, layerY, 
                        layerX + layerWidth, layerY + layerHeight
                    );
                    
                    if (layer === 0) {
                        treeGradient.addColorStop(0, '#228B22');
                        treeGradient.addColorStop(1, '#006400');
                    } else if (layer === 1) {
                        treeGradient.addColorStop(0, '#32CD32');
                        treeGradient.addColorStop(1, '#228B22');
                    } else {
                        treeGradient.addColorStop(0, '#7CFC00');
                        treeGradient.addColorStop(1, '#32CD32');
                    }
                    
                    // ç»˜åˆ¶æ ‘å† ä¸‰è§’å½¢
                    ctx.fillStyle = treeGradient;
                    ctx.beginPath();
                    ctx.moveTo(layerX, layerY + layerHeight);
                    ctx.lineTo(layerX + layerWidth, layerY + layerHeight);
                    ctx.lineTo(width / 2, layerY);
                    ctx.closePath();
                    ctx.fill();
                    
                    // æ·»åŠ æ ‘å† çº¹ç†
                    ctx.strokeStyle = '#90EE90';
                    ctx.lineWidth = 1.5;
                    
                    const textureLines = 4;
                    for (let i = 1; i < textureLines; i++) {
                        const lineY = layerY + (layerHeight / textureLines) * i;
                        const lineWidth = layerWidth * (1 - i / textureLines);
                        const lineX = width / 2 - lineWidth / 2;
                        
                        ctx.beginPath();
                        ctx.moveTo(lineX, lineY);
                        ctx.lineTo(lineX + lineWidth, lineY);
                        ctx.stroke();
                    }
                }
                
                console.log('åœ£è¯æ ‘ç»˜åˆ¶å®Œæˆ');
            }
            
            // åˆå§‹ç»˜åˆ¶å’Œçª—å£è°ƒæ•´æ—¶é‡ç»˜
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
        }

        // 2. åˆå§‹åŒ–é›ªèŠ±
        function initSnowflakes() {
            console.log('åˆå§‹åŒ–é›ªèŠ±...');
            const container = document.getElementById('snowflakesContainer');
            
            // åˆ›å»ºé›ªèŠ±æ ·å¼
            if (!document.querySelector('#snowStyles')) {
                const snowStyles = document.createElement('style');
                snowStyles.id = 'snowStyles';
                snowStyles.textContent = `
                    .snowflake {
                        position: absolute;
                        background: white;
                        border-radius: 50%;
                        pointer-events: none;
                        filter: blur(0.8px);
                        z-index: 1;
                        top: -10px;
                    }
                `;
                document.head.appendChild(snowStyles);
            }
            
            function createSnowflake() {
                if (!snowEnabled) return;
                
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                
                // éšæœºå¤§å°å’Œé€æ˜åº¦
                const size = Math.random() * 5 + 2;
                snowflake.style.width = `${size}px`;
                snowflake.style.height = `${size}px`;
                snowflake.style.opacity = Math.random() * 0.6 + 0.3;
                
                // éšæœºèµ·å§‹ä½ç½®
                snowflake.style.left = `${Math.random() * 100}vw`;
                
                // éšæœºé£˜åŠ¨å¹…åº¦
                const sway = Math.random() * 40 - 20;
                snowflake.style.setProperty('--sway', `${sway}px`);
                
                // éšæœºåŠ¨ç”»æ—¶é•¿
                const duration = Math.random() * 8 + 6;
                snowflake.style.animation = `snowFall ${duration}s linear infinite`;
                
                container.appendChild(snowflake);
                
                // é›ªèŠ±è½åœ°åç§»é™¤
                setTimeout(() => {
                    if (snowflake.parentNode === container) {
                        snowflake.remove();
                    }
                }, duration * 1000);
            }
            
            // åˆå§‹åˆ›å»ºä¸€æ‰¹é›ªèŠ±
            for (let i = 0; i < 40; i++) {
                setTimeout(() => createSnowflake(), Math.random() * 2000);
            }
            
            // æŒç»­åˆ›å»ºé›ªèŠ±
            setInterval(createSnowflake, 350);
        }

        // 3. åˆå§‹åŒ–å½©ç¯
        function initLights() {
            console.log('åˆå§‹åŒ–å½©ç¯...');
            const container = document.querySelector('.tree-section');
            
            // ç§»é™¤ç°æœ‰å½©ç¯
            document.querySelectorAll('.light').forEach(light => light.remove());
            lights = [];
            
            if (!lightsEnabled) return;
            
            const colors = [
                '#FF0000', '#00FF00', '#FFFF00', '#1E90FF', 
                '#FF69B4', '#FFA500', '#9370DB', '#00FFFF',
                '#FF1493', '#00FF7F', '#FFD700', '#7B68EE'
            ];
            
            const canvas = document.getElementById('treeCanvas');
            const rect = canvas.getBoundingClientRect();
            
            // åˆ›å»ºå½©ç¯
            for (let i = 0; i < 35; i++) {
                const light = document.createElement('div');
                light.className = 'light';
                
                // è®¡ç®—ç¯çš„ä½ç½®ï¼ˆåœ¨æ ‘å† åŒºåŸŸå†…ï¼‰
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 130 + 20;
                
                const centerX = rect.width / 2;
                const centerY = rect.height / 2 - 50;
                
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                // ç¡®ä¿ç¯åœ¨ç”»å¸ƒèŒƒå›´å†…
                if (x < 20 || x > rect.width - 20 || y < 20 || y > rect.height - 50) {
                    continue;
                }
                
                light.style.left = `${x}px`;
                light.style.top = `${y}px`;
                
                // éšæœºé¢œè‰²å’Œå¤§å°
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 10 + 6;
                
                light.style.width = `${size}px`;
                light.style.height = `${size}px`;
                light.style.backgroundColor = color;
                light.style.boxShadow = `0 0 ${size/1.5}px ${color}`;
                
                // éšæœºé—ªçƒåŠ¨ç”»
                const delay = Math.random() * 2;
                const duration = Math.random() * 1.2 + 0.8;
                light.style.animation = `twinkle ${duration}s infinite ${delay}s alternate`;
                
                container.appendChild(light);
                lights.push(light);
            }
            
            console.log(`åˆ›å»ºäº† ${lights.length} ä¸ªå½©ç¯`);
        }

        // 4. åˆå§‹åŒ–ç¥ç¦åŠŸèƒ½
        function initBlessings() {
            console.log('åˆå§‹åŒ–ç¥ç¦åŠŸèƒ½...');
            const newBlessingBtn = document.getElementById('newBlessing');
            const dynamicMessage = document.getElementById('dynamicMessage');
            const historyList = document.getElementById('historyList');
            
            // è·å–éšæœºç¥ç¦
            function getRandomBlessing() {
                return blessings[Math.floor(Math.random() * blessings.length)];
            }
            
            // æ˜¾ç¤ºæ–°ç¥ç¦
            function showNewBlessing() {
                const blessing = getRandomBlessing();
                
                // æ›´æ–°æ˜¾ç¤º
                dynamicMessage.textContent = blessing.text;
                dynamicMessage.style.color = blessing.color;
                dynamicMessage.style.textShadow = `0 0 8px ${blessing.color}`;
                
                // æ·»åŠ åˆ°å†å²è®°å½•
                addToHistory(blessing.text);
                
                // æ˜¾ç¤ºå¼¹çª—
                showPopup("ğŸ… åœ£è¯ç¥ç¦ ğŸ…", blessing.text);
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                dynamicMessage.style.animation = 'none';
                setTimeout(() => {
                    dynamicMessage.style.animation = 'fadeIn 0.5s ease';
                }, 10);
                
                // è§¦å‘å½©ç¯é—ªçƒæ•ˆæœ
                triggerLightTwinkle();
            }
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            function addToHistory(message) {
                const timestamp = new Date().toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                });
                
                const historyItem = {
                    message: message,
                    time: timestamp
                };
                
                blessingHistory.unshift(historyItem);
                
                // ä¿æŒæœ€å¤š8æ¡è®°å½•
                if (blessingHistory.length > 8) {
                    blessingHistory.pop();
                }
                
                updateHistoryDisplay();
            }
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            function updateHistoryDisplay() {
                historyList.innerHTML = '';
                
                blessingHistory.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span style="color:#87CEEB; font-size:0.8rem;">${item.time}</span> - ${item.message}`;
                    historyList.appendChild(li);
                });
            }
            
            // è§¦å‘å½©ç¯é—ªçƒ
            function triggerLightTwinkle() {
                if (!lightsEnabled) return;
                
                lights.forEach(light => {
                    // éšæœºæ”¹å˜ä¸€äº›ç¯çš„åŠ¨ç”»
                    if (Math.random() > 0.7) {
                        const originalAnimation = light.style.animation;
                        light.style.animation = 'twinkle 0.3s ease 3';
                        
                        setTimeout(() => {
                            light.style.animation = originalAnimation;
                        }, 1000);
                    }
                });
            }
            
            // ç»‘å®šäº‹ä»¶
            newBlessingBtn.addEventListener('click', showNewBlessing);
            
            // åˆå§‹æ˜¾ç¤ºä¸€æ¡ç¥ç¦
            setTimeout(() => {
                showNewBlessing();
            }, 1500);
        }

        // 5. åˆå§‹åŒ–æ§åˆ¶åŠŸèƒ½
        function initControls() {
            console.log('åˆå§‹åŒ–æ§åˆ¶åŠŸèƒ½...');
            const musicToggle = document.getElementById('musicToggle');
            const snowToggle = document.getElementById('snowToggle');
            const lightsToggle = document.getElementById('lightsToggle');
            const shareButton = document.getElementById('shareButton');
            const bgMusic = document.getElementById('bgMusic');
            const closePopup = document.getElementById('closePopup');
            const popup = document.getElementById('blessingPopup');
            
            // éŸ³ä¹æ§åˆ¶
            musicToggle.addEventListener('click', function() {
                musicEnabled = !musicEnabled;
                const span = this.querySelector('span');
                
                try {
                    if (musicEnabled) {
                        bgMusic.play().catch(e => {
                            console.log("éŸ³ä¹æ’­æ”¾è¢«é˜»æ­¢:", e);
                            // æ˜¾ç¤ºæç¤º
                            showPopup("æç¤º", "ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®åï¼Œå†ç‚¹å‡»éŸ³ä¹æŒ‰é’®å¼€å¯èƒŒæ™¯éŸ³ä¹");
                        });
                        span.textContent = 'éŸ³ä¹: å¼€å¯';
                    } else {
                        bgMusic.pause();
                        span.textContent = 'éŸ³ä¹: å…³é—­';
                    }
                } catch (error) {
                    console.error("éŸ³ä¹æ§åˆ¶é”™è¯¯:", error);
                }
            });
            
            // é›ªèŠ±æ§åˆ¶
            snowToggle.addEventListener('click', function() {
                snowEnabled = !snowEnabled;
                const span = this.querySelector('span');
                span.textContent = snowEnabled ? 'é›ªèŠ±: å¼€å¯' : 'é›ªèŠ±: å…³é—­';
                
                const snowflakes = document.querySelectorAll('.snowflake');
                snowflakes.forEach(flake => {
                    flake.style.animationPlayState = snowEnabled ? 'running' : 'paused';
                    flake.style.opacity = snowEnabled ? '0.7' : '0';
                });
            });
            
            // å½©ç¯æ§åˆ¶
            lightsToggle.addEventListener('click', function() {
                lightsEnabled = !lightsEnabled;
                const span = this.querySelector('span');
                span.textContent = lightsEnabled ? 'å½©ç¯: å¼€å¯' : 'å½©ç¯: å…³é—­';
                
                if (lightsEnabled) {
                    initLights();
                } else {
                    document.querySelectorAll('.light').forEach(light => light.remove());
                    lights = [];
                }
            });
            
            // åˆ†äº«åŠŸèƒ½
            shareButton.addEventListener('click', function() {
                const pageUrl = window.location.href;
                const shareText = "ğŸ„ çœ‹çœ‹è¿™ä¸ªè¶…ç¾çš„åŠ¨æ€åœ£è¯æ ‘ï¼Œå¯ä»¥è·å–ä¸“å±åœ£è¯ç¥ç¦ï¼";
                
                // æ£€æŸ¥æ˜¯å¦æ”¯æŒWeb Share API
                if (navigator.share) {
                    navigator.share({
                        title: 'è¶…æµªæ¼«åŠ¨æ€åœ£è¯æ ‘',
                        text: shareText,
                        url: pageUrl
                    })
                    .then(() => console.log('åˆ†äº«æˆåŠŸ'))
                    .catch(err => {
                        console.log('åˆ†äº«å¤±è´¥æˆ–å–æ¶ˆ:', err);
                        copyToClipboard(pageUrl);
                    });
                } else {
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šå¤åˆ¶é“¾æ¥
                    copyToClipboard(pageUrl);
                }
            });
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            function copyToClipboard(text) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showPopup("åˆ†äº«æç¤º", "é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nå¯ä»¥ç²˜è´´åˆ†äº«ç»™æœ‹å‹äº†ã€‚");
                    })
                    .catch(err => {
                        console.error('å¤åˆ¶å¤±è´¥:', err);
                        // é™çº§æ–¹æ¡ˆ
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textArea);
                        showPopup("åˆ†äº«æç¤º", "é“¾æ¥å·²å¤åˆ¶ï¼å¯ä»¥åˆ†äº«ç»™æœ‹å‹äº†ã€‚");
                    });
            }
            
            // å¼¹çª—æ§åˆ¶
            closePopup.addEventListener('click', function() {
                popup.style.display = 'none';
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    popup.style.display = 'none';
                }
            });
            
            // å°è¯•è‡ªåŠ¨æ’­æ”¾éŸ³ä¹ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            document.body.addEventListener('click', function initMusic() {
                if (musicEnabled) {
                    bgMusic.play().catch(e => {
                        console.log("ç­‰å¾…ç”¨æˆ·äº¤äº’åæ’­æ”¾éŸ³ä¹");
                    });
                }
                document.body.removeEventListener('click', initMusic);
            }, { once: true });
        }

        // 6. åˆå§‹åŒ–äº¤äº’å¼åœ£è¯æ ‘
        function initInteractiveTree() {
            console.log('åˆå§‹åŒ–äº¤äº’åŠŸèƒ½...');
            const canvas = document.getElementById('treeCanvas');
            
            // ç‚¹å‡»åœ£è¯æ ‘
            canvas.addEventListener('click', function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // è§¦å‘ç¥ç¦
                document.getElementById('newBlessing').click();
                
                // æ·»åŠ ç‚¹å‡»æ•ˆæœ
                createClickEffect(x, y);
            });
            
            // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
            let touchTimer;
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                
                // é•¿æŒ‰æ£€æµ‹ï¼ˆä¿å­˜å›¾ç‰‡ï¼‰
                touchTimer = setTimeout(() => {
                    saveTreeAsImage();
                }, 800);
                
                // çŸ­æŒ‰è§¦å‘ç¥ç¦
                setTimeout(() => {
                    document.getElementById('newBlessing').click();
                    createClickEffect(x, y);
                }, 200);
            });
            
            canvas.addEventListener('touchend', function() {
                clearTimeout(touchTimer);
            });
            
            // é¼ æ ‡æ‚¬åœæ•ˆæœ
            canvas.addEventListener('mousemove', function(e) {
                if (!lightsEnabled) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // é¼ æ ‡é™„è¿‘çš„ç¯å˜äº®
                lights.forEach(light => {
                    const lightX = parseFloat(light.style.left);
                    const lightY = parseFloat(light.style.top);
                    
                    const distance = Math.sqrt(
                        Math.pow(x - lightX, 2) + Math.pow(y - lightY, 2)
                    );
                    
                    if (distance < 50) {
                        light.style.transform = 'scale(1.3)';
                        light.style.opacity = '1';
                    } else {
                        light.style.transform = 'scale(1)';
                        light.style.opacity = '0.8';
                    }
                });
            });
        }

        // 7. åˆ›å»ºç‚¹å‡»æ•ˆæœ
        function createClickEffect(x, y) {
            const canvas = document.getElementById('treeCanvas');
            const ctx = canvas.getContext('2d');
            
            // ç»˜åˆ¶ç‚¹å‡»æ¶Ÿæ¼ªæ•ˆæœ
            let radius = 0;
            const maxRadius = 25;
            const color = `hsl(${Math.random() * 360}, 100%, 65%)`;
            
            function drawRipple() {
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.globalAlpha = 1 - (radius / maxRadius);
                ctx.stroke();
                
                radius += 1.5;
                
                if (radius < maxRadius) {
                    requestAnimationFrame(drawRipple);
                } else {
                    ctx.globalAlpha = 1;
                    // é‡ç»˜åœ£è¯æ ‘ï¼ˆæ¸…é™¤æ¶Ÿæ¼ªï¼‰
                    const width = canvas.width;
                    const height = canvas.height;
                    ctx.clearRect(0, 0, width, height);
                    
                    // é‡æ–°ç»˜åˆ¶åœ£è¯æ ‘
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = width;
                    tempCanvas.height = height;
                    const tempCtx = tempCanvas.getContext('2d');
                    
                    // ä¿å­˜å½“å‰åœ£è¯æ ‘çŠ¶æ€ï¼ˆç®€åŒ–å¤„ç†ï¼‰
                    setTimeout(() => {
                        initChristmasTree();
                    }, 50);
                }
            }
            
            drawRipple();
        }

        // 8. æ˜¾ç¤ºå¼¹çª—
        function showPopup(title, message) {
            const popup = document.getElementById('blessingPopup');
            const popupTitle = document.getElementById('popupTitle');
            const popupMessage = document.getElementById('popupMessage');
            
            popupTitle.textContent = title;
            popupMessage.textContent = message;
            popup.style.display = 'flex';
            
            // 3ç§’åè‡ªåŠ¨å…³é—­
            setTimeout(() => {
                if (popup.style.display === 'flex') {
                    popup.style.display = 'none';
                }
            }, 3000);
        }

        // 9. ä¿å­˜ä¸ºå›¾ç‰‡
        function saveTreeAsImage() {
            const canvas = document.getElementById('treeCanvas');
            
            // åˆ›å»ºä¸´æ—¶ç”»å¸ƒç”¨äºé«˜è´¨é‡å¯¼å‡º
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width * 2;
            tempCanvas.height = canvas.height * 2;
            const tempCtx = tempCanvas.getContext('2d');
            
            // ç™½è‰²èƒŒæ™¯
            tempCtx.fillStyle = '#0c2b3e';
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
            
            // ç¼©æ”¾ç»˜åˆ¶
            tempCtx.scale(2, 2);
            tempCtx.drawImage(canvas, 0, 0);
            
            // æ·»åŠ æ–‡å­—
            tempCtx.scale(1, 1); // é‡ç½®ç¼©æ”¾
            tempCtx.font = '24px Microsoft YaHei';
            tempCtx.fillStyle = '#FFD700';
            tempCtx.textAlign = 'center';
            tempCtx.fillText('âœ¨ åœ£è¯å¿«ä¹ âœ¨', tempCanvas.width / 2, tempCanvas.height - 40);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const link = document.createElement('a');
            const timestamp = new Date().getTime();
            link.download = `åœ£è¯æ ‘-${timestamp}.png`;
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
            
            showPopup("ä¿å­˜æˆåŠŸ", "åœ£è¯æ ‘å›¾ç‰‡å·²ä¿å­˜åˆ°æ‚¨çš„è®¾å¤‡ä¸­ï¼");
        }

        // 10. é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶æš‚åœéŸ³ä¹
                const bgMusic = document.getElementById('bgMusic');
                if (musicEnabled && !bgMusic.paused) {
                    bgMusic.pause();
                }
            } else {
                // é¡µé¢æ˜¾ç¤ºæ—¶æ¢å¤éŸ³ä¹
                const bgMusic = document.getElementById('bgMusic');
                if (musicEnabled && bgMusic.paused) {
                    bgMusic.play().catch(e => console.log("æ¢å¤æ’­æ”¾å¤±è´¥:", e));
                }
            }
        });

        // åˆå§‹åŒ–å½©ç¯
        setTimeout(() => {
            initLights();
        }, 1000);

        console.log('åœ£è¯æ ‘é¡µé¢åˆå§‹åŒ–å®Œæˆï¼');
    </script>
</body>
</html>